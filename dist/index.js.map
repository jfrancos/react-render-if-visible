{"version":3,"file":"index.js","sources":["../src/render-if-visible.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react'\n\nconst isServer = typeof window === 'undefined'\n\ntype Props = {\n  /** An estimate of the element's height */\n  defaultHeight?: number\n  /** How far outside the viewport in pixels should elements be considered visible?  */\n  visibleOffset?: number\n  root?: HTMLElement | null\n  children: React.ReactNode\n}\n\nconst RenderIfVisible = ({\n  defaultHeight = 300,\n  visibleOffset = 1000,\n  root = null,\n  children\n}: Props) => {\n  const [isVisible, setIsVisible] = useState<boolean>(isServer)\n  const placeholderHeight = useRef<number>(defaultHeight)\n  const intersectionRef = useRef<HTMLDivElement>(null)\n\n  // Set visibility with intersection observer\n  useEffect(() => {\n    if (intersectionRef.current) {\n      const observer = new IntersectionObserver(\n        entries => {\n          if (typeof window !== undefined && window.requestIdleCallback) {\n            window.requestIdleCallback(\n              () => setIsVisible(entries[0].isIntersecting),\n              {\n                timeout: 600\n              }\n            )\n          } else {\n            setIsVisible(entries[0].isIntersecting)\n          }\n        },\n        { root, rootMargin: `${visibleOffset}px 0px ${visibleOffset}px 0px` }\n      )\n      observer.observe(intersectionRef.current)\n      return () => {\n        if (intersectionRef.current) {\n          observer.unobserve(intersectionRef.current)\n        }\n      }\n    }\n    return () => {}\n  }, [intersectionRef])\n\n  // Set true height for placeholder element after render.\n  useEffect(() => {\n    if (intersectionRef.current && isVisible) {\n      placeholderHeight.current = intersectionRef.current.offsetHeight\n    }\n  }, [isVisible, intersectionRef])\n\n  return (\n    <div ref={intersectionRef}>\n      {isVisible ? (\n        <>{children}</>\n      ) : (\n        <div style={{ height: placeholderHeight.current }} />\n      )}\n    </div>\n  )\n}\n\nexport default RenderIfVisible\n"],"names":["useRef","useEffect","React"],"mappings":";;;;;;;AAEA,IAAM,QAAQ,GAAG,OAAO,MAAM,KAAK,WAAW,CAAA;AAW9C,IAAM,eAAe,GAAG,UAAC,EAKjB;QAJN,qBAAmB,EAAnB,wCAAmB,EACnB,qBAAoB,EAApB,yCAAoB,EACpB,YAAW,EAAX,gCAAW,EACX,sBAAQ;IAEF,IAAA,6BAAuD,EAAtD,iBAAS,EAAE,oBAAY,CAA+B;IAC7D,IAAM,iBAAiB,GAAGA,YAAM,CAAS,aAAa,CAAC,CAAA;IACvD,IAAM,eAAe,GAAGA,YAAM,CAAiB,IAAI,CAAC,CAAA;;IAGpDC,eAAS,CAAC;QACR,IAAI,eAAe,CAAC,OAAO,EAAE;YAC3B,IAAM,UAAQ,GAAG,IAAI,oBAAoB,CACvC,UAAA,OAAO;gBACL,IAAI,OAAO,MAAM,KAAK,SAAS,IAAI,MAAM,CAAC,mBAAmB,EAAE;oBAC7D,MAAM,CAAC,mBAAmB,CACxB,cAAM,OAAA,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,GAAA,EAC7C;wBACE,OAAO,EAAE,GAAG;qBACb,CACF,CAAA;iBACF;qBAAM;oBACL,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAA;iBACxC;aACF,EACD,EAAE,IAAI,MAAA,EAAE,UAAU,EAAK,aAAa,eAAU,aAAa,WAAQ,EAAE,CACtE,CAAA;YACD,UAAQ,CAAC,OAAO,CAAC,eAAe,CAAC,OAAO,CAAC,CAAA;YACzC,OAAO;gBACL,IAAI,eAAe,CAAC,OAAO,EAAE;oBAC3B,UAAQ,CAAC,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,CAAA;iBAC5C;aACF,CAAA;SACF;QACD,OAAO,eAAQ,CAAA;KAChB,EAAE,CAAC,eAAe,CAAC,CAAC,CAAA;;IAGrBA,eAAS,CAAC;QACR,IAAI,eAAe,CAAC,OAAO,IAAI,SAAS,EAAE;YACxC,iBAAiB,CAAC,OAAO,GAAG,eAAe,CAAC,OAAO,CAAC,YAAY,CAAA;SACjE;KACF,EAAE,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC,CAAA;IAEhC,QACEC,sCAAK,GAAG,EAAE,eAAe,IACtB,SAAS,IACRA,4DAAG,QAAQ,CAAI,KAEfA,sCAAK,KAAK,EAAE,EAAE,MAAM,EAAE,iBAAiB,CAAC,OAAO,EAAE,GAAI,CACtD,CACG,EACP;AACH,CAAC;;;;"}